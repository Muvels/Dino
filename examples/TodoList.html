<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dino - Todo List</title>
  </head>
  <body>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../dist/bundle.umd.js"></script>
    <script lang="ts">
      const { HtmlDocument, Reactive, h } = Dino;

      const TodoItem = (props) => {
        const todo = props.todo;

        const taskItem = h
          .li()
          .addClass(['flex', 'items-center', 'mb-2'])
          .appendChild(
            h
              .input()
              .setType('checkbox')
              .bindChecked('completed', todo)
              .addClass(['mr-2'])
              .onInput(() => {
                todo.completed = !todo.completed;
              }),
          )
          .appendChild(
            h
              .span()
              .bindTextContent('text', todo)
              .addClass(
                todo.completed ? ['line-through', 'text-gray-500'] : [],
              ),
          );

        Reactive.effect(() => {
          todo.completed
            ? taskItem.addClass(['line-through', 'text-gray-500'])
            : taskItem.removeClass(['line-through', 'text-gray-500']);
        });

        return taskItem;
      };

      const TodoApp = () => {
        const reactiveData = new Reactive({
          todos: [],
          newTodo: '',
        });

        const addTodo = () => {
          if (reactiveData.newTodo.trim() !== '') {
            reactiveData.todos.push({
              text: reactiveData.newTodo,
              completed: false,
            });
            reactiveData.newTodo = '';
          }
        };

        return h
          .div()
          .addClass(['bg-gray-200', 'p-4', 'rounded'])
          .appendChild(
            h
              .h1()
              .setTextContent('Todo List')
              .setStyle({ fontSize: '2rem', marginBottom: '1rem' }),
          )
          .appendChild(
            h
              .div()
              .addClass(['flex'])
              .appendChild(
                h
                  .input()
                  .bindValue('newTodo', reactiveData)
                  .addClass(['flex-grow', 'mr-2', 'px-2', 'py-1', 'rounded'])
                  .onInput((e) => (reactiveData.newTodo = e.target.value)),
              )
              .appendChild(
                h
                  .button()
                  .addClass([
                    'bg-blue-500',
                    'text-white',
                    'px-4',
                    'py-2',
                    'rounded',
                  ])
                  .setTextContent('Add Todo')
                  .onClick(addTodo),
              ),
          )
          .appendChild(
            h
              .ul()
              .addClass(['mt-4'])
              .bindForEach('todos', reactiveData, (todo) => TodoItem({ todo })),
          );
      };

      new HtmlDocument(TodoApp());
    </script>
  </body>
</html>
